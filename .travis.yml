language: cpp
compiler: gcc
dist: trusty

before_install:
    # C++17
    - sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test
    - sudo apt-get update -qq

install:
    # C++17
    - sudo apt-get install -qq g++-6
    - sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-6 90
    # Codecov
    - sudo update-alternatives --install /usr/bin/gcov gcov /usr/bin/gcov-6 90
    - sudo pip install codecov

script:
    - for filename in ./codes/*.cpp; do
        ARGS="-std=c++11 -ftest-coverage -fprofile-arcs";
        g++ $ARGS -c ${filename} -o ${filename}.o;
        g++ $ARGS ${filename}.o -o ${filename}.run;
        ${filename}.run;
        mv ${filename}.gcno ${filename%.*}.gcno;
        mv ${filename}.gcda ${filename%.*}.gcda;
        gcov ${filename};
        rm -f ${filename}.run;
        rm -f ${filename}.o;
        rm -f ${filename%.*}.gcno;
        rm -f ${filename%.*}.gcda;
      done
    - codecov
